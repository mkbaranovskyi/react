# Redux

- [Redux](#redux)
	- [Sources](#sources)
	- [Intro](#intro)
		- [Install & Run](#install--run)
		- [Redux DevTools](#redux-devtools)
		- [Redux Toolkit](#redux-toolkit)
		- [Basics](#basics)
			- [When to use](#when-to-use)
			- [Bank analogy](#bank-analogy)
	- [Core Components](#core-components)
	- [Data Flow](#data-flow)
	- [Middleware](#middleware)

***

## Sources

1. https://youtu.be/YdYyYMFPa44 - Minin tutorial
2. https://github.com/zalmoxisus/redux-devtools-extension#installation - Redux DevTools

***

## Intro

### Install & Run

Client (if you need):

```html
<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
```

Server:

```bash
npx create-react-app test --template redux
# OR
npx create-react-app test --template redux-typescript
```

***

### Redux DevTools

Install the Redux DevTools browser [extension](https://github.com/zalmoxisus/redux-devtools-extension#installation). Then change your code to activate it for your local app. There're 2 ways to do that:

1. First way:

```js
import { compose } from 'redux'

const store = createStore(
	rootReducer,
	compose(
		applyMiddleware(thunk, logger),
		window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
	)
)
```

2. Second way (preferable): `npm i redux-devtools-extension` and:

```js
import { composeWithDevTools } from 'redux-devtools-extension'

const store = createStore(
	rootReducer,
	composeWithDevTools(applyMiddleware(thunk, logger))
)
```

***

### Redux Toolkit 

[Redux Toolkit](https://redux-toolkit.js.org/introduction/getting-started) is the recommended way to build production apps with Redux.

***

### Basics 

Redux is a container managing the **global state** of your app. 

It can be used with any framework or without any.

It usually consists of these elements:

- `state` is an object holding some important info about your app
- `store` is an ultimate storage of your **state**
- `action creator` is a function creating **actions**
- `action` is an object describing changes to the **state**
- `reducer` is a function that performs changes to the **state**

#### When to use

1. You have several states in your app
2. The app state is needed in many places of your app
3. The state update logic is complex
5. You need some degree of abstraction for a large app with many devs on it.

#### Bank analogy

Bank is a **store** holding the clients' money (**states**). You go to the bank to withdraw some of your money. But you don't take the money from the storage yourself - you go to a cashier or ATM (**reducer**) and perform one of the standard requests (**action**): "WITHDRAW_MONEY". The cashier (**reducer**) receives your request (**action**), gives you the money and changes your balance (**state**) to a lower number.

***


## Core Components

**Store** is a container holding the app's global **state**.

- Has methods:
  - `dispatch(action)` - makes the store run its *reducer* to update the *state*
  - `getState()` - returns the current state
  - `subscribe(cb)` - *cb* will be called each time the *state* is updated
- **Never** directly change the state inside the store
- To change the state
  1. create an **action object** describing the changes, and **dispatch** it to the store
  2. when the action is dispatched, the store runs the root **reducer function** which **calculates the new state** based on the old state and the action
  3. the store **notifies subscribers** about the state updates so they can render the changes. 

**State** is an object with any number of fields.

**Action** object/function tells the *store* how to update *state*.

- has properties:
  - `type: string` - a readable name
  - `payload: any` - optional data

**Action creator** - a function creating *actions*.

**Reducer** is a function that accepts the current state and an *action* and returns the new state (or the old one if nothing has changed).

- accepts `(currentState, action)` as parameters
- returns either a **new object** representing the new *state* or an **old state unchanged**. 

`createStore` accepts only one reducer, so if we have several reducers, we have to unite them into a single `rootReducer`.

```js
// === Store ===
const store = Redux.createStore(rootReducer)

// === State ===
const initialState = {
	value: 0
}

// === Reducer ===
function counterReducer(state = initialState, action){
	switch(action.type){
		case 'counter/increment':
			return {...state, value: state.value + 1}
		case 'counter/decrement':
			return {...state, value: state.value - 1}
		default:
			return state
	}
}

// === Action ===
const action = {
	type: 'counter/decrement',
	payload: null
}

// Chenge the state
store.dispatch(action)
```

***

## Data Flow 

![](img/2021-05-03-18-56-53.png)



***

## Middleware

We simply list the middleware we want in the comma-separated list of `applyMiddleware` parameters when we create our **store**.	

```js
import { applyMiddleware, createStore } from 'redux'

// Example middleware
function logger(state) {
	return function (next) {
		return function (action) {
			console.log('state: ', state)
			console.log('action: ', action)
			return next(action)
		}
	}
}

const store = createStore(
	rootReducer, 
	0, // initial state
	applyMiddleware(thunk, logger)
)
```

***